<?php 

namespace iutnc\netvod\action;
use iutnc\netvod\render\SerieRender;

//DisplayCatalogue : 
// si user connecté
// -> affiche catalogue des séries
// --> affiche series en cours
// --> affiche puis series avec le genre préf
// --> affiche toutes les séries restantes

class DisplayCatalogueAction extends Action {


    function execute(): string
    {   
        $series_total = 
        // On suppose que c'est 4 listes différentes
        $cours_serie = $_SESSION['encours']->__get("enCours"); // de type EnCours->Array
        $serie_genre_pref = $_SESSION['preferences']->__get("series"); // de type MesPreference->Array
        $serie_pref = $_SESSION['profil']['genre_pref']; // de type Array
        $serie_restants = array_diff($series_total, $serie_genre_pref, $cours_serie, $serie_pref) ; // entre toutes les séries 
        
        $html = '<h1> Catalogue <h1>';

        // si user connecté
        if (isset($_SESSION['user'])){
            // affichage du catalogue : 

            // affichage des séries en cours : 
            foreach($cours_serie as $serie){
                //Renderer
                $renderer = new SerieRender($serie);
                $html .= $renderer->render(1);
            }
            
            // affichage des séries avec le genre pref : 
            foreach($serie_genre_pref as $serie){
                //Renderer
                $renderer = new SerieRender($serie);
                $html .= $renderer->render(1);
            }
            
            // affichage des séries restantes : 
            foreach($serie_restants as $serie){
                //Renderer
                $renderer = new SerieRender($serie);
                $html .= $renderer->render(1);
            }
            
            
        }

        else{
            header('Location: ?action=signin');
            exit();
        }

        return $html;
    }
    
}